# A2A Demo CenterSection 리팩토링 계획서

## 작업의 목적

현재 정적인 3-section 레이아웃에서 동적 플레이어 기반 아키텍처로의 마이그레이션을 완료하고, AI Agent의 내부 처리 로직을 시각화하여 사용자에게 Agent의 상황 판단 과정을 명확하게 전달하는 것을 목표로 합니다.

### 구체적인 목표

1. **동적 구조 지원**: Customer - Agent - 3rd Party의 동적 구조로 변경
2. **AI Agent 시각화**: Agent의 step을 Card 형태로 누적 표시하여 내부 로직을 이해할 수 있게 함
3. **상태 관리 통합**: 모든 상태 관리를 기존 `scenario.tsx`와 `useScenarioControl.ts`에 집중
4. **사용자 경험 개선**: Brain + Gearbox 애니메이션과 Auto-scroll 기능으로 직관적인 인터페이스 제공

## 현재의 상태 / 문제점

### CenterSection 컴포넌트의 문제점

```tsx
// 현재 CenterSection/index.tsx의 문제 코드
export function CenterSection() {
  const { state } = useScenario();

  // ❌ 정의되지 않은 변수 사용
  switch (centerSectionState.status) { // centerSectionState가 정의되지 않음
    case "processing":
      return Zap;
    // ...
  }

  // ❌ 정의되지 않은 변수 사용
  {currentScenario && ( // currentScenario가 정의되지 않음
    // ...
  )}
}
```

### 주요 문제점들

1. **미정의 변수 사용**: `centerSectionState`, `currentScenario` 변수가 선언되지 않아 런타임 에러 발생
2. **잘못된 상태 관리**: `useScenario` hook을 import했으나 제대로 활용하지 못함
3. **정적 구조 유지**: 현재 구조가 동적 플레이어 기반으로 변경되지 못함
4. **시각화 부족**: AI Agent의 내부 로직이 사용자에게 명확하게 전달되지 않음

### 기존 작업 현황

- ✅ Migration documentation (4개 MD 파일) 작성 완료
- ✅ Player auto-play 컴포넌트 구현 완료
- ✅ ScenarioSelector 단순화 완료
- ✅ useScenarioControl 타입 호환성 수정 완료
- ❌ CenterSection 완전 재작성 필요

## 추가 분석 과제 (선택적)

### 애니메이션 최적화 분석

- Brain 아이콘의 bouncing 애니메이션과 Gearbox 아이콘의 rotating 애니메이션이 성능에 미치는 영향 분석
- Auto-scroll 기능의 부드러운 스크롤 구현 방안 연구
- Card 추가 시의 entrance 애니메이션 효과 분석

### 데이터 플로우 최적화

- 대용량 시나리오 데이터 처리 시 메모리 사용량 분석
- 실시간 Card 추가 시 UI 렌더링 성능 모니터링

## 변경 이후의 상태 / 해결 판정 기준

### 성공 판정 기준

1. **기능적 완성도**

   - CenterSection이 `useScenario` hook을 통해 모든 상태를 정상적으로 수신
   - AI Agent의 각 step이 Card 형태로 누적 표시됨
   - Brain + Gearbox 애니메이션이 Agent 처리 중에 정상 작동
   - 새로운 Card 추가 시 Auto-scroll 기능이 작동

2. **코드 품질 기준**

   - TypeScript 컴파일 에러 없음
   - ESLint 경고/에러 없음
   - 모든 변수와 함수가 올바르게 정의되고 사용됨

3. **사용자 경험 기준**
   - Agent의 상황 판단 과정이 명확하게 시각화됨
   - 애니메이션이 부드럽고 성능에 영향 미치지 않음
   - 반응형 디자인으로 다양한 화면 크기 지원

### 테스트 완료 조건

- [ ] CenterSection 컴포넌트가 정상 렌더링됨
- [ ] 시나리오 진행 중 Card가 순차적으로 추가됨
- [ ] Brain/Gearbox 애니메이션이 상태에 따라 정상 작동
- [ ] Auto-scroll이 새로운 Card 추가 시 작동
- [ ] 모든 기존 기능 (Player, ScenarioSelector)과 호환

## 수정이 필요한 코드 및 수정부분의 코드 스니핏

### 1. CenterSection/index.tsx 완전 재작성

**현재 문제 코드:**

```tsx
// ❌ 잘못된 변수 사용으로 인한 런타임 에러
switch (
  centerSectionState.status // centerSectionState undefined
) {
  case "processing":
    return Zap;
  // ...
}
```

**변경 후 코드 구조:**

```tsx
// ✅ 올바른 useScenario hook 사용
export function CenterSection() {
  const { state } = useScenario();
  const { current, progress } = useScenarioControl();

  // Agent 로직 카드 리스트 상태
  const [logicCards, setLogicCards] = useState<LogicCard[]>([]);

  // 새로운 카드 추가 핸들러
  const addLogicCard = useCallback((step: AgenticStep) => {
    const newCard: LogicCard = {
      id: Date.now().toString(),
      step,
      timestamp: new Date(),
    };
    setLogicCards((prev) => [...prev, newCard]);
  }, []);

  // Auto-scroll ref
  const scrollRef = useRef<HTMLDivElement>(null);

  return (
    <div className="center-section">
      {/* Agent 상태 헤더 (Brain + Gearbox) */}
      <AgentStatusHeader isProcessing={isProcessing} />

      {/* Agent 로직 카드 리스트 */}
      <LogicCardList cards={logicCards} scrollRef={scrollRef} />
    </div>
  );
}
```

### 2. 새로운 컴포넌트 생성 필요

**AgentStatusHeader 컴포넌트:**

```tsx
interface AgentStatusHeaderProps {
  isProcessing: boolean;
}

export function AgentStatusHeader({ isProcessing }: AgentStatusHeaderProps) {
  return (
    <div className="flex items-center space-x-4">
      {/* Brain 아이콘 - bouncing 애니메이션 */}
      <motion.div
        animate={isProcessing ? { y: [0, -5, 0] } : {}}
        transition={{ duration: 1, repeat: isProcessing ? Infinity : 0 }}
      >
        <Brain className="w-8 h-8 text-primary" />
      </motion.div>

      {/* Gearbox 아이콘 - rotating 애니메이션 */}
      <motion.div
        animate={isProcessing ? { rotate: 360 } : {}}
        transition={{ duration: 2, repeat: isProcessing ? Infinity : 0 }}
      >
        <Settings className="w-8 h-8 text-primary" />
      </motion.div>
    </div>
  );
}
```

**LogicCard 컴포넌트:**

```tsx
interface LogicCardProps {
  card: LogicCard;
}

export function LogicCard({ card }: LogicCardProps) {
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      className="bg-card border border-border rounded-lg p-4"
    >
      <div className="flex items-center space-x-2">
        <Badge variant="secondary">{card.step.type}</Badge>
        <span className="text-sm text-muted-foreground">
          {card.timestamp.toLocaleTimeString()}
        </span>
      </div>
      <p className="mt-2 text-sm">{card.step.action.description}</p>
    </motion.div>
  );
}
```

## 재사용 가능한 연관 코드 (파일 경로, 주요 기능, 인터페이스 등 포함)

### 핵심 상태 관리 파일들

**`/src/contexts/scenario.tsx`**

- **주요 기능**: 시나리오 상태 관리 및 통신 액션 처리
- **핵심 인터페이스**:

  ```typescript
  interface Scenario {
    id: string;
    title: string;
    description: string;
    agents: Agent[];
    humans: Human[];
    steps: AgenticStep[];
  }

  interface AgenticStep {
    type: string;
    action: Record<string, unknown>;
  }
  ```

**`/src/hooks/useScenarioControl.ts`**

- **주요 기능**: 시나리오 진행 제어 및 프로그레스 관리
- **제공 인터페이스**:

  ```typescript
  interface UseScenarioControlReturnType {
    current: Scenario;
    scenarios: Scenario[];
    progress: number;
    setCurrent: (index: number) => void;
    progressNext: () => void;
  }
  ```

**`/src/hooks/useScenario.ts`**

- **주요 기능**: 시나리오 컨텍스트 접근
- **사용법**: `const { state } = useScenario();`

### 재사용 가능한 UI 컴포넌트들

**`/src/components/shared/AgentRobot/index.tsx`**

- **주요 기능**: AI Agent 로봇 아이콘 표시
- **Props**: `size?: number; isThinking?: boolean`

**`/src/components/ui/card.tsx`**

- **주요 기능**: 카드 레이아웃 컴포넌트
- **사용법**: shadcn/ui Card 컴포넌트 활용

**`/src/components/ui/badge.tsx`**

- **주요 기능**: 뱃지 컴포넌트로 상태 표시
- **사용법**: shadcn/ui Badge 컴포넌트 활용

### 유틸리티 및 설정 파일들

**`/src/lib/utils.ts`**

- **주요 기능**: `cn()` 함수로 클래스명 조건부 적용
- **사용법**: `cn("base-class", condition && "additional-class")`

**`/src/types/index.ts`**

- **주요 기능**: 공통 타입 정의
- **활용**: 프로젝트 전반의 타입 안전성 확보

## Test Code 추가 및 수정 필요 부분에 대한 가이드

### 단위 테스트 추가

**CenterSection 컴포넌트 테스트:**

```typescript
// src/components/DemoView/CenterSection/__tests__/index.test.tsx
import { render, screen } from "@testing-library/react";
import { CenterSection } from "../index";
import { ScenarioProvider } from "@/contexts/scenario";

describe("CenterSection", () => {
  it("renders without crashing", () => {
    render(
      <ScenarioProvider>
        <CenterSection />
      </ScenarioProvider>
    );

    expect(screen.getByText("AI Agent")).toBeInTheDocument();
  });

  it("displays logic cards when steps are processed", () => {
    // 시나리오 진행 중 카드가 추가되는지 테스트
  });
});
```

**AgentStatusHeader 컴포넌트 테스트:**

```typescript
// src/components/DemoView/CenterSection/__tests__/AgentStatusHeader.test.tsx
describe("AgentStatusHeader", () => {
  it("shows brain animation when processing", () => {
    // Brain 아이콘 bouncing 애니메이션 테스트
  });

  it("shows gearbox animation when processing", () => {
    // Gearbox 아이콘 rotating 애니메이션 테스트
  });
});
```

### 통합 테스트 추가

**시나리오 진행 통합 테스트:**

```typescript
// src/__tests__/scenario-integration.test.tsx
describe("Scenario Integration", () => {
  it("CenterSection updates when scenario progresses", () => {
    // 시나리오 진행 시 CenterSection이 올바르게 업데이트되는지 테스트
  });

  it("auto-scroll works when new cards are added", () => {
    // 새로운 카드 추가 시 auto-scroll 기능 테스트
  });
});
```

### 테스트 실행 가이드

```bash
# 단위 테스트 실행
bun test src/components/DemoView/CenterSection/

# 통합 테스트 실행
bun test src/__tests__/scenario-integration.test.tsx

# 테스트 커버리지 확인
bun test --coverage
```

### E2E 테스트 고려사항

- Playwright 또는 Cypress를 활용한 E2E 테스트 구현 고려
- 시나리오 전체 플로우 테스트 (선택 → 진행 → 결과 확인)
- 애니메이션 효과 확인을 위한 시각적 회귀 테스트

---

## 작업 우선순위 및 체크리스트

### Phase 1: 기초 구조 구축 (1-2일)

- [ ] CenterSection 컴포넌트 기본 구조 재작성
- [ ] useScenario hook 올바르게 통합
- [ ] 기본 TypeScript 컴파일 에러 해결

### Phase 2: Agent 로직 시각화 (2-3일)

- [ ] AgentStatusHeader 컴포넌트 생성 (Brain + Gearbox 애니메이션)
- [ ] LogicCard 컴포넌트 생성
- [ ] LogicCardList 컴포넌트 생성

### Phase 3: 고급 기능 구현 (1-2일)

- [ ] Auto-scroll 기능 구현
- [ ] Card 추가 애니메이션 구현
- [ ] 반응형 디자인 최적화

### Phase 4: 테스트 및 최적화 (1일)

- [ ] 단위 테스트 작성 및 통과
- [ ] 통합 테스트 작성 및 통과
- [ ] 성능 최적화 및 코드 리뷰

## 참고 사항

- **상태 관리**: 모든 상태는 `scenario.tsx`와 `useScenarioControl.ts`를 통해 관리
- **타입 안전성**: TypeScript strict 모드 준수
- **성능 고려**: 대용량 시나리오 데이터 처리 시 메모리 사용량 모니터링
- **접근성**: 애니메이션 효과가 접근성에 미치는 영향 고려
- **브라우저 호환성**: CSS 애니메이션과 Framer Motion 호환성 확인

이 계획서를 통해 개발팀은 체계적이고 효율적으로 CenterSection 리팩토링 작업을 진행할 수 있습니다.
