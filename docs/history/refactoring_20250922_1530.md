# Entity displayName 및 avatarUrl 추가 리팩토링 플랜

## 작업의 목적

시나리오의 각 Entity(agents, customer, servers)에 `displayName`과 `avatarUrl` 필드를 추가하여 사용자 경험을 개선합니다:
- `displayName`: UI에서 기술적인 `name` 대신 사용자 친화적인 표시 이름 제공
- `avatarUrl`: 각 Entity에 맞는 커스텀 아바타 이미지 지원으로 시각적 식별성 향상

이를 통해 더 직관적이고 개인화된 사용자 경험을 제공합니다.

## 현재의 상태 / 문제점

### 현재 상태

- Entity 인터페이스에는 `name`과 `type` 필드만 존재
- UI 컴포넌트들이 `entity.name`을 직접 표시하여 기술적인 식별자가 사용자에게 노출됨
- scenarios.json에서 `name` 필드가 시스템 식별자와 표시 목적을 동시에 담당
- 아바타 이미지가 Entity 타입에 따른 기본값만 사용됨 (getAvatarProps 함수 기반)

### 문제점

1. **사용자 경험 저하**: `customer_agent`, `restaurant_owner` 같은 기술적 식별자가 UI에 그대로 노출
2. **국제화 어려움**: 하드코딩된 영어 이름으로 인해 다국어 지원 제약
3. **유지보수성**: 표시 이름 변경 시 여러 UI 컴포넌트를 수정해야 함
4. **일관성 부족**: 같은 Entity의 표시 이름이 컴포넌트마다 다를 수 있음
5. **시각적 단조로움**: 모든 동일 타입 Entity가 같은 기본 아바타 사용으로 구분 어려움
6. **개인화 부족**: 특정 인물이나 브랜드를 나타내는 Entity의 개성 표현 제한

### 영향받는 UI 요소들

**표시 이름 관련**:
- DemoView/AgentSection: `agent?.name || 'AI Agent'`
- DemoView/ServerSection: `server.name`
- DemoView/CustomerSection: `customer?.name || 'Customer'`
- HomeScreen: `entity?.name || 'Contact'`
- TerminalSection: `entity?.name || 'AI Agent'`
- ReasoningAgentSection: `entity?.name || 'AI Agent'`
- PhoneSection: `entity?.name || contactName`

**아바타 이미지 관련**:
- HomeScreen: `getAvatarProps(senderType)` 사용하여 기본 아바타 표시
- VoiceBubble: `getAvatarProps(senderType)` 사용
- MessageBubble: `getAvatarProps(senderType)` 사용
- VoiceScreen: `getCallerAvatarProps()` 사용

## 관련 코드의 통합 구조 (Birdeye View)

```
src/
├── contexts/
│   └── scenario.tsx              # Entity 인터페이스 정의
├── data/
│   └── scenarios.json            # 시나리오 데이터 (Entity 인스턴스)
├── components/
│   ├── DemoView/
│   │   ├── AgentSection/index.tsx      # agent.name 사용
│   │   ├── CustomerSection/index.tsx   # customer.name 사용
│   │   └── ServerSection/index.tsx     # server.name 사용
│   └── shared/
│       ├── HomeScreen/index.tsx        # entity.name 사용
│       ├── TerminalSection/index.tsx   # entity.name 사용
│       ├── ReasoningAgentSection/      # entity.name 사용
│       └── PhoneSection/index.tsx      # entity.name 사용
└── hooks/
    └── useScenario.ts            # 시나리오 데이터 제공
```

### 데이터 흐름

1. `scenarios.json` → `useScenario()` → Entity 데이터 제공
2. Entity 데이터 → UI 컴포넌트 → `entity.name` 표시
3. UI 컴포넌트에서 fallback 로직으로 기본값 처리

### 핵심 인터페이스

```typescript
export interface Entity {
  type: 'human' | 'ai';
  name: string; // 시스템 식별자
  // displayName: string;  // 추가할 표시용 이름
}
```

## 변경 이후의 상태 / 해결 판정 기준

### 목표 상태

1. **타입 시스템**: Entity 인터페이스에 `displayName`과 `avatarUrl` 필드 추가
2. **데이터 구조**: scenarios.json의 모든 Entity에 displayName과 avatarUrl 필드 존재
3. **UI 컴포넌트**: `entity.displayName || entity.name` 패턴 적용
4. **아바타 시스템**: `entity.avatarUrl || 기본아바타` 패턴으로 커스텀 아바타 우선 사용
5. **Fallback 처리**: 필드가 없는 경우 기존 방식으로 동작하는 안전장치

### 해결 판정 기준

- [ ] Entity 인터페이스에 `displayName?: string`, `avatarUrl?: string` 필드 추가 완료
- [ ] scenarios.json의 모든 agents, customer, servers에 해당 필드 추가 완료
- [ ] UI 컴포넌트들이 displayName 우선 사용 패턴으로 변경 완료
- [ ] 아바타 컴포넌트들이 Entity의 avatarUrl 우선 사용하도록 변경 완료
- [ ] 기존 시나리오가 정상 동작하며 표시 이름과 아바타가 개선됨을 확인
- [ ] TypeScript 컴파일 에러 없음
- [ ] 런타임에서 displayName과 커스텀 아바타가 정상적으로 표시됨

## 수정이 필요한 코드 및 수정부분의 코드 스니핏

### 1. Entity 인터페이스 확장

**파일**: `src/contexts/scenario.tsx`

```typescript
// 기존
export interface Entity {
  type: 'human' | 'ai';
  name: string;
}

// 변경 후
export interface Entity {
  type: 'human' | 'ai';
  name: string;
  displayName?: string;  // 선택적 필드로 추가하여 기존 호환성 유지
  avatarUrl?: string;    // 커스텀 아바타 이미지 URL (선택적)
}
```

### 2. 시나리오 데이터 확장

**파일**: `src/data/scenarios.json`

```json
// 기존
{
  "type": "ai",
  "name": "customer_agent",
  "steps": []
}

// 변경 후
{
  "type": "ai",
  "name": "customer_agent",
  "displayName": "고객 에이전트",
  "avatarUrl": "/assets/avatars/customer_agent.png",
  "steps": []
}

// Human Entity 예시
{
  "type": "human",
  "name": "restaurant_owner",
  "displayName": "명동키친 사장님",
  "avatarUrl": "/assets/avatars/restaurant_owner.jpg",
  "state": "message",
  "messageBox": {}
}
```
```

### 3. DemoView 컴포넌트 수정

**파일**: `src/components/DemoView/AgentSection/index.tsx`

```typescript
### 3. DemoView 컴포넌트 수정

**파일**: `src/components/DemoView/AgentSection/index.tsx`

```typescript
// 기존 (라인 24, 31)
label={agent?.name || 'AI Agent'}
entityName={agent?.name}

// 변경 후
label={agent?.displayName || agent?.name || 'AI Agent'}
entityName={agent?.name}  // 시스템 로직용은 name 유지
```

**파일**: `src/components/DemoView/ServerSection/index.tsx`

```typescript
// 기존 (라인 24, 42, 47)
label={server.name}
label={server.name}

// 변경 후
label={server.displayName || server.name}
label={server.displayName || server.name}
```

### 4. Shared 컴포넌트 수정

**파일**: `src/components/shared/HomeScreen/index.tsx`

```typescript
// 기존 (라인 28)
const displayName = entity?.name || 'Contact';

// 변경 후
const displayName = entity?.displayName || entity?.name || 'Contact';

// 아바타 부분 수정 (라인 77-85)
// 기존
{avatarProps.src ? (
  <img
    src={avatarProps.src}
    alt={avatarProps.alt}
    className="w-full h-full object-cover"
  />
) : avatarProps.fallbackIcon ? (
  <avatarProps.fallbackIcon className="w-8 h-8 text-white" />
) : (
  <User className="w-8 h-8 text-white" />
)}

// 변경 후
{entity?.avatarUrl ? (
  <img
    src={entity.avatarUrl}
    alt={entity.displayName || entity.name || 'Avatar'}
    className="w-full h-full object-cover"
  />
) : avatarProps.src ? (
  <img
    src={avatarProps.src}
    alt={avatarProps.alt}
    className="w-full h-full object-cover"
  />
) : avatarProps.fallbackIcon ? (
  <avatarProps.fallbackIcon className="w-8 h-8 text-white" />
) : (
  <User className="w-8 h-8 text-white" />
)}
```

**파일**: `src/components/shared/TerminalSection/index.tsx`

```typescript
// 기존 (라인 297)
Connected to {entity?.name || 'AI Agent'} | Status: ACTIVE

// 변경 후
Connected to {entity?.displayName || entity?.name || 'AI Agent'} | Status: ACTIVE
```

**파일**: `src/components/shared/ReasoningAgentSection/index.tsx`

```typescript
// 기존 (라인 530)
{entity?.name || 'AI Agent'}

// 변경 후
{entity?.displayName || entity?.name || 'AI Agent'}
```

### 5. 아바타 헬퍼 함수 확장

**파일**: `src/components/shared/Avatar/avatarHelpers.ts`

```typescript
// 새로운 함수 추가
export function getEntityAvatarProps(
  entity?: Entity | null,
  fallbackSenderType?: 'user' | 'ai' | 'agent' | 'server-human'
) {
  // Entity에 avatarUrl이 있으면 우선 사용
  if (entity?.avatarUrl) {
    return {
      src: entity.avatarUrl,
      alt: entity.displayName || entity.name || 'Avatar',
      fallbackIcon: undefined,
    };
  }
  
  // 없으면 기존 로직 사용
  return getAvatarProps(fallbackSenderType);
}
```

### 6. 아바타 사용 컴포넌트 업데이트

**파일**: `src/components/shared/VoiceBubble/index.tsx`

```typescript
// 기존
{...getAvatarProps(senderType)}

// 변경 후 (entity prop이 있는 경우)
{...getEntityAvatarProps(entity, senderType)}
```

**파일**: `src/components/shared/MessageBubble/index.tsx`

```typescript
// 기존
{...getAvatarProps(senderType)}

// 변경 후 (entity prop이 있는 경우)
{...getEntityAvatarProps(entity, senderType)}
```
```

**파일**: `src/components/DemoView/ServerSection/index.tsx`

```typescript
// 기존 (라인 24, 42, 47)
label={server.name}
label={server.name}

// 변경 후
label={server.displayName || server.name}
label={server.displayName || server.name}
```

### 4. Shared 컴포넌트 수정

**파일**: `src/components/shared/HomeScreen/index.tsx`

```typescript
// 기존 (라인 28)
const displayName = entity?.name || 'Contact';

// 변경 후
const displayName = entity?.displayName || entity?.name || 'Contact';
```

**파일**: `src/components/shared/TerminalSection/index.tsx`

```typescript
// 기존 (라인 297)
Connected to {entity?.name || 'AI Agent'} | Status: ACTIVE

// 변경 후
Connected to {entity?.displayName || entity?.name || 'AI Agent'} | Status: ACTIVE
```

**파일**: `src/components/shared/ReasoningAgentSection/index.tsx`

```typescript
// 기존 (라인 530)
{
  entity?.name || 'AI Agent';
}

// 변경 후
{
  entity?.displayName || entity?.name || 'AI Agent';
}
```

## 재사용 가능한 연관 코드

### 주요 파일들과 역할

1. **`src/contexts/scenario.tsx`**
   - Entity 인터페이스 정의
   - HumanState, ServerState 등 확장 인터페이스들
   - 시나리오 관리 핵심 로직

2. **`src/hooks/useScenario.ts`**
   - 시나리오 데이터 접근 Hook
   - Entity 데이터를 컴포넌트에 제공
   - 재사용 가능한 시나리오 상태 관리

3. **`src/components/shared/SectionLabel/index.tsx`**
   - 섹션 라벨 표시 공통 컴포넌트
   - label prop을 통해 Entity 이름 표시

4. **`src/lib/utils.ts`**
   - cn() 유틸리티 함수
   - 공통 유틸리티 로직

### 기존 코드 패턴 활용

```typescript
// 현재 사용중인 fallback 패턴
entity?.name || 'Default Name';

// 확장할 패턴
entity?.displayName || entity?.name || 'Default Name';
```

## Test Code 추가 및 수정 필요 부분에 대한 가이드

### 테스트 시나리오

1. **단위 테스트**
   - Entity 인터페이스 타입 검증 (displayName, avatarUrl 포함)
   - displayName이 있는 경우와 없는 경우 UI 렌더링 확인
   - avatarUrl이 있는 경우와 없는 경우 아바타 표시 확인
   - fallback 로직 동작 검증 (displayName → name, avatarUrl → 기본아바타)

2. **통합 테스트**
   - scenarios.json 로딩 후 새 필드들 존재 확인
   - DemoView 컴포넌트들이 displayName과 커스텀 아바타를 올바르게 표시하는지 확인
   - 기존 시나리오가 깨지지 않고 동작하는지 확인
   - 아바타 로딩 실패 시 fallback 동작 확인

3. **수동 테스트 가이드**
   - [ ] 시나리오 선택 후 각 섹션에서 한글 이름 표시 확인
   - [ ] displayName이 없는 Entity의 경우 name으로 fallback 확인
   - [ ] 커스텀 아바타가 있는 Entity의 아바타 표시 확인
   - [ ] avatarUrl이 없는 Entity의 기본 아바타 표시 확인
   - [ ] 아바타 이미지 로딩 실패 시 fallback 아이콘 표시 확인
   - [ ] 다양한 화면 크기에서 긴 displayName과 아바타 표시 확인

### 테스트 데이터 예시

```json
// 테스트용 scenarios.json 일부
{
  "test_scenario": {
    "agents": [
      {
        "type": "ai",
        "name": "test_agent",
        "displayName": "테스트 에이전트",
        "avatarUrl": "/assets/test/agent_avatar.png"
      }
    ],
    "customer": {
      "type": "human", 
      "name": "test_customer",
      "displayName": "김철수 고객",
      "avatarUrl": "/assets/test/customer_avatar.jpg"
    },
    "servers": [
      {
        "type": "human",
        "name": "test_server",
        "displayName": "테스트 서버",
        // avatarUrl 없음 - 기본 아바타 사용
        "state": "message"
      }
    ]
  }
}
```

### 아바타 이미지 준비

```text
public/assets/avatars/
├── customer_agent.png     # AI 고객 에이전트
├── restaurant_owner.jpg   # 식당 사장님
├── elderly_person.jpg     # 어르신 고객
├── taxi_driver.png        # 택시 기사
└── health_assistant.png   # 건강 도우미 에이전트
```

## 추가 분석 과제

1. **다국어 지원 확장성**
   - 향후 i18n 적용 시 displayName 다국어 처리 방안 검토
   - locale별 displayName 구조 설계 고려

2. **성능 영향 분석**
   - scenarios.json 파일 크기 증가에 따른 로딩 성능 영향
   - 아바타 이미지 로딩 성능 최적화 방안 (lazy loading, 압축 등)
   - 메모리 사용량 변화 측정

3. **사용자 경험 개선**
   - 긴 displayName에 대한 UI 레이아웃 처리 방안
   - 아바타 이미지 로딩 중 skeleton UI 적용
   - 아바타 이미지 크기 최적화 및 반응형 대응

4. **아바타 시스템 확장**
   - 동적 아바타 생성 API 연동 가능성 검토
   - 아바타 캐싱 및 CDN 적용 방안
   - 접근성을 위한 alt text 자동 생성 로직

## 주의사항

- **하위 호환성**: displayName과 avatarUrl을 선택적 필드로 하여 기존 코드 호환성 유지
- **시스템 로직 보존**: entityName, 필터링 등 시스템 로직에서는 계속 name 사용
- **점진적 적용**: 핵심 UI부터 순차적으로 적용하여 리스크 최소화
- **테스트 우선**: 각 컴포넌트별 변경 후 즉시 테스트하여 문제 조기 발견
- **이미지 최적화**: 아바타 이미지는 적절한 크기로 최적화하여 성능 영향 최소화
- **오류 처리**: 아바타 이미지 로딩 실패 시 graceful fallback 보장
- **접근성**: 모든 아바타에 적절한 alt text 제공하여 스크린 리더 지원