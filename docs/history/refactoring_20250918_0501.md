# Refactoring Plan: Test 컴포넌트 Scrollytelling 애니메이션 고도화

**작성일시**: 2025년 9월 18일  
**작성자**: AI Assistant  
**파일명**: `./docs/history/refactoring_20250918_0501.md`

## 작업의 목적

Test 컴포넌트(`/src/components/Test/index.tsx`)에서 Slide들이 풍부한 scrollytelling 애니메이션을 제공하도록 개선하여 사용자 경험을 향상시키고, 데이터 시각화의 몰입도를 높인다.

## 현재의 상태 / 문제점

### 1. 애니메이션 부재 문제

- **Slide004**: 소상공인(500만개) vs 대기업(3,300개) 비교 바 차트가 정적임
- **Slide005**: POS 기기 보유율(11.7%) vs 예약시스템 도입률(1.4%) 수직 바 차트가 정적임
- **기타 슬라이드들**: 뷰포트 진입 시 등장 애니메이션 없음

### 2. 현재 활용 가능한 기술 스택

- **GSAP + ScrollTrigger**: 이미 설정되어 있음
- **PinningContext**: `isEntering`, `isLeaving`, `isPinned` 상태 관리 가능
- **AnimatedBarChart/AnimatedCounter**: `/src/components/shared/`에 이미 구현되어 있음

## 추가 분석 과제

1. **슬라이드별 애니메이션 요구사항 분석**
   - 각 Slide 컴포넌트의 데이터 시각화 요소 식별
   - 차트 타입별 최적 애니메이션 패턴 정의

2. **PinningContext 연동 방식 검토**
   - 현재 시나리오에만 적용된 PinningContext를 슬라이드에도 확장하는 방안
   - isEntering 상태와 GSAP ScrollTrigger의 onEnter 콜백 연동 방안

3. **성능 최적화 고려사항**
   - 16개 슬라이드의 동시 애니메이션 처리 시 성능 영향
   - 애니메이션 리소스 관리 및 메모리 최적화

## 변경 이후의 상태 / 해결 판정 기준

### 성공 기준

1. **Slide004, Slide005의 차트 애니메이션 구현**
   - 바가 서서히 차오르며 숫자가 카운트업되는 효과
   - 뷰포트 진입 시 자동 트리거

2. **전체 슬라이드 등장 애니메이션 적용**
   - fade-in, slide-up 등 일관된 등장 효과
   - 스크롤 진행도에 따른 자연스러운 연출

3. **scrollytelling 경험 향상**
   - 사용자가 스크롤할 때마다 시각적 피드백 제공
   - pinned 슬라이드와 일반 슬라이드 구분된 애니메이션

### 판정 기준

- [ ] Slide004의 수평 바 차트 애니메이션 동작
- [ ] Slide005의 수직 바 차트 애니메이션 동작
- [ ] 모든 슬라이드에 등장 애니메이션 적용
- [ ] 애니메이션이 스크롤 진행도와 동기화
- [ ] 성능 저하 없이 부드러운 애니메이션 구현

## 수정이 필요한 코드 및 수정부분의 코드 스니핏

### 1. AnimatedSlide 래퍼 컴포넌트 생성

```typescript
// 새 파일: /src/components/shared/AnimatedSlide.tsx
import { useContext, useEffect, useRef } from 'react';
import { PinningContext } from '@/contexts/pinning';
import { gsap } from 'gsap';
import { cn } from '@/lib/utils';

interface AnimatedSlideProps {
  children: React.ReactNode;
  animationType?: 'fade' | 'slideUp' | 'slideDown' | 'scale';
  delay?: number;
}

export function AnimatedSlide({
  children,
  animationType = 'fade',
  delay = 0
}: AnimatedSlideProps) {
  const { isEntering } = useContext(PinningContext);
  const ref = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (isEntering && ref.current) {
      const animations = {
        fade: { from: { opacity: 0 }, to: { opacity: 1 } },
        slideUp: { from: { opacity: 0, y: 50 }, to: { opacity: 1, y: 0 } },
        slideDown: { from: { opacity: 0, y: -50 }, to: { opacity: 1, y: 0 } },
        scale: { from: { opacity: 0, scale: 0.8 }, to: { opacity: 1, scale: 1 } }
      };

      const anim = animations[animationType];
      gsap.fromTo(ref.current, anim.from, {
        ...anim.to,
        duration: 0.8,
        delay,
        ease: 'power2.out'
      });
    }
  }, [isEntering, animationType, delay]);

  return (
    <div ref={ref} className={cn('transition-all')}>
      {children}
    </div>
  );
}
```

### 2. Slide004 애니메이션 적용

```typescript
// 수정: /src/components/Slide/Slide004.tsx
import { useContext, useEffect, useRef, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { PinningContext } from "@/contexts/pinning";
import { gsap } from "gsap";
import { AnimatedSlide } from '../shared/AnimatedSlide';

function Slide004() {
  const { isEntering } = useContext(PinningContext);
  const bar1Ref = useRef<HTMLDivElement>(null);
  const bar2Ref = useRef<HTMLDivElement>(null);
  const [count1, setCount1] = useState(0);
  const [count2, setCount2] = useState(0);

  useEffect(() => {
    if (isEntering) {
      // 첫 번째 바 애니메이션 (100% 너비)
      gsap.fromTo(bar1Ref.current,
        { width: "0%" },
        { width: "100%", duration: 1.5, ease: "power2.out" }
      );

      // 두 번째 바 애니메이션 (6.6% 너비)
      gsap.fromTo(bar2Ref.current,
        { width: "0%" },
        { width: "6.6%", duration: 1.5, ease: "power2.out" }
      );

      // 숫자 카운트업 애니메이션
      gsap.to({}, {
        duration: 1.5,
        onUpdate: function () {
          const progress = this.progress();
          setCount1(Math.round(progress * 500));
          setCount2(Math.round(progress * 3300));
        }
      });
    }
  }, [isEntering]);

  return (
    <AnimatedSlide animationType="slideUp">
      <div className="min-h-screen w-full bg-background text-foreground flex flex-col items-center justify-center p-4 sm:p-8 font-sans">
        {/* 기존 헤더 */}
        <header className="text-center space-y-6">
          {/* ... 기존 코드 ... */}
        </header>

        {/* 애니메이션이 적용된 바 차트 */}
        <Card className="bg-card border-border p-8">
          <CardContent className="p-0">
            <div className="space-y-12">
              {/* 첫 번째 바 차트 - 애니메이션 적용 */}
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <div className="space-y-2">
                    <p className="text-lg font-semibold text-foreground">
                      동네식당, 카페, 미용실, 세탁소 등
                    </p>
                    <p className="text-base text-muted-foreground">
                      소상공인 사업체 수
                    </p>
                  </div>
                  <div className="text-right">
                    <p className="text-3xl font-bold text-foreground">약 {count1}만 개</p>
                  </div>
                </div>
                <div className="w-full h-8 bg-muted rounded-full overflow-hidden">
                  <div
                    ref={bar1Ref}
                    className="h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"
                    style={{ width: "0%" }}
                  />
                </div>
              </div>

              {/* 두 번째 바 차트 - 애니메이션 적용 */}
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <div className="space-y-2">
                    <p className="text-lg font-semibold text-foreground">
                      프렌차이즈, 유통 F&B 등
                    </p>
                    <p className="text-base text-muted-foreground">
                      대기업 사업체 수
                    </p>
                  </div>
                  <div className="text-right">
                    <p className="text-3xl font-bold text-foreground">약 {count2} 개</p>
                  </div>
                </div>
                <div className="w-full h-8 bg-muted rounded-full overflow-hidden">
                  <div
                    ref={bar2Ref}
                    className="h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"
                    style={{ width: "0%" }}
                  />
                </div>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* 기존 푸터 */}
        <footer className="text-center space-y-4">
          {/* ... 기존 코드 ... */}
        </footer>
      </div>
    </AnimatedSlide>
  );
}
```

### 3. Slide005 애니메이션 적용

```typescript
// 수정: /src/components/Slide/Slide005.tsx
import { useContext, useEffect, useRef, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { PinningContext } from "@/contexts/pinning";
import { gsap } from "gsap";
import { AnimatedSlide } from '../shared/AnimatedSlide';

function Slide005() {
  const { isEntering } = useContext(PinningContext);
  const bar1Ref = useRef<HTMLDivElement>(null);
  const bar2Ref = useRef<HTMLDivElement>(null);
  const [percent1, setPercent1] = useState(0);
  const [percent2, setPercent2] = useState(0);

  useEffect(() => {
    if (isEntering) {
      // 첫 번째 바 애니메이션 (60px 높이)
      gsap.fromTo(bar1Ref.current,
        { height: "0px" },
        { height: "60px", duration: 1.2, ease: "power2.out" }
      );

      // 두 번째 바 애니메이션 (8px 높이)
      gsap.fromTo(bar2Ref.current,
        { height: "0px" },
        { height: "8px", duration: 1.2, ease: "power2.out" }
      );

      // 퍼센트 카운트업
      gsap.to({}, {
        duration: 1.2,
        onUpdate: function () {
          const progress = this.progress();
          setPercent1(parseFloat((progress * 11.7).toFixed(1)));
          setPercent2(parseFloat((progress * 1.4).toFixed(1)));
        }
      });
    }
  }, [isEntering]);

  return (
    <AnimatedSlide animationType="slideUp">
      <div className="min-h-screen w-full bg-background text-foreground flex flex-col items-center justify-center p-4 sm:p-8 font-sans">
        {/* 기존 헤더 */}
        <header className="text-center space-y-6">
          {/* ... 기존 코드 ... */}
        </header>

        {/* 애니메이션이 적용된 수직 바 차트 */}
        <Card className="bg-card border-border p-8">
          <CardContent className="p-0">
            <div className="flex flex-row items-end justify-center gap-24 py-12">
              {/* 첫 번째 수직 바 차트 */}
              <div className="flex flex-col items-center">
                <div className="relative flex flex-col items-center">
                  <div
                    ref={bar1Ref}
                    className="w-20 bg-gradient-to-r from-blue-500 to-purple-500 rounded-t-lg absolute bottom-0"
                    style={{ height: "0px" }}
                  />
                  <div className="w-20 bg-muted rounded-lg border-2 border-border" style={{ height: "200px" }} />
                  <span className="absolute -top-16 left-1/2 -translate-x-1/2 text-4xl font-bold text-foreground">
                    {percent1}%
                  </span>
                </div>
                <div className="mt-6 text-center space-y-2">
                  <div className="text-sm text-muted-foreground">'21년기준 전통시장</div>
                  <div className="font-bold text-foreground text-lg">Pos 기기 보유율</div>
                </div>
              </div>

              {/* 두 번째 수직 바 차트 */}
              <div className="flex flex-col items-center">
                <div className="relative flex flex-col items-center">
                  <div
                    ref={bar2Ref}
                    className="w-20 bg-gradient-to-r from-blue-500 to-purple-500 rounded-t-lg absolute bottom-0"
                    style={{ height: "0px" }}
                  />
                  <div className="w-20 bg-muted rounded-lg border-2 border-border" style={{ height: "200px" }} />
                  <span className="absolute -top-16 left-1/2 -translate-x-1/2 text-4xl font-bold text-foreground">
                    {percent2}%
                  </span>
                </div>
                <div className="mt-6 text-center space-y-2">
                  <div className="text-sm text-muted-foreground">'24년기준</div>
                  <div className="font-bold text-foreground text-lg">예약 시스템 (카카오테이블) 도입률</div>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </AnimatedSlide>
  );
}
```

### 4. Test 컴포넌트 슬라이드별 PinningContext 적용

```typescript
// 수정: /src/components/Test/index.tsx
// slideComponents.map 부분에 PinningContext 추가

{slideComponents.map((slide, index) => {
  const { Component, pinned } = slide;

  // 슬라이드별 pinning 상태 생성
  const slidePinningState = {
    isPinned: false,
    isEntering: false,
    isLeaving: false,
  };

  return (
    <PinningContext.Provider value={slidePinningState} key={`slide-${index}`}>
      <section
        ref={pinned ? (el: HTMLDivElement | null) => { slideRefs.current[index] = el; } : undefined}
        className="min-h-screen w-full bg-background text-foreground flex flex-col items-center justify-center"
      >
        <div className="w-full max-w-7xl px-4">
          <Component />
        </div>
      </section>
    </PinningContext.Provider>
  );
})}
```

## 재사용 가능한 연관 코드

### 기존 활용 가능한 컴포넌트

1. **AnimatedBarChart** (`/src/components/shared/AnimatedBarChart.tsx`)
   - 이미 GSAP ScrollTrigger와 연동된 바 차트 컴포넌트
   - Slide003에서 사용 중

2. **AnimatedCounter** (`/src/components/shared/AnimatedCounter.tsx`)
   - 숫자 카운트업 애니메이션 컴포넌트
   - Slide003에서 사용 중

3. **PinningContext** (`/src/contexts/pinning.tsx`)
   - `isPinned`, `isEntering`, `isLeaving` 상태 관리
   - 시나리오 섹션에서 활용 중

### 추가 개발 필요한 컴포넌트

1. **AnimatedSlide** (신규)
   - 모든 슬라이드에 공통 적용할 래퍼 컴포넌트
   - 다양한 애니메이션 타입 지원

2. **ScrollTrigger 확장**
   - 슬라이드별 isEntering 상태 관리
   - onEnter/onLeave 콜백으로 PinningContext 업데이트

## Test Code 추가 및 수정 필요 부분에 대한 가이드

### 단위 테스트 영역

1. **AnimatedSlide 컴포넌트 테스트**
   - PinningContext의 isEntering 상태 변화에 따른 애니메이션 트리거 검증
   - 다양한 animationType props에 대한 렌더링 테스트

2. **Slide004, Slide005 애니메이션 테스트**
   - GSAP 애니메이션 실행 여부 검증
   - 숫자 카운트업 정확성 테스트
   - 바 차트 크기 변화 테스트

### 통합 테스트 영역

1. **ScrollTrigger 통합 테스트**
   - 스크롤 시 PinningContext 상태 변화 검증
   - 애니메이션과 스크롤 진행도 동기화 테스트

2. **성능 테스트**
   - 16개 슬라이드 동시 로드 시 메모리 사용량
   - 애니메이션 실행 시 FPS 측정

### 테스트 파일 구조

```
/src/components/Test/__tests__/
  ├── GSAPPinningDemo.test.tsx
  ├── AnimatedSlide.test.tsx
  └── SlideAnimations.test.tsx

/src/components/Slide/__tests__/
  ├── Slide004.test.tsx
  └── Slide005.test.tsx
```

## 추가 고려사항

1. **접근성 (a11y)**
   - 애니메이션 비활성화 옵션 제공
   - `prefers-reduced-motion` CSS 미디어 쿼리 지원

2. **모바일 최적화**
   - 터치 스크롤과 애니메이션 동기화
   - 작은 화면에서의 차트 가독성

3. **브라우저 호환성**
   - GSAP ScrollTrigger 지원 브라우저 확인
   - 폴백 애니메이션 제공

---

**완료 예상 시간**: 4-6시간  
**우선순위**: High (사용자 경험 개선의 핵심 요소)  
**의존성**: GSAP, React Context API, TypeScript
