# PhoneSection 하위 요소 Theme 분기 처리 리팩토링 계획

## 작업의 목적

PhoneSection 하위 컴포넌트들이 명시적인 Theme 분기 로직을 통해 일관된 Theme 적용이 가능하도록 하여, 코드 레벨에서 Theme 상태를 제어하고 디버깅할 수 있는 구조로 개선한다.

## 현재의 상태 / 문제점

### 현재 구조
- PhoneSection 하위 요소들(`PhoneFrame`, `MessageScreen`, `CallScreen`, `HomeScreen`, `SectionLabel`, `IncomingCallOverlay`)이 Tailwind CSS의 `.dark`/`.light` 클래스와 CSS 변수에만 의존
- Theme 분기가 CSS 레벨에서만 처리되어 코드에서 명시적인 제어 불가능
- `force-light-theme` CSS 클래스로 강제 Light Theme 적용 중 (CSS-only 접근법)

### 문제점
1. **코드 분기 불가**: 하위 컴포넌트에서 "현재 Theme이 무엇인지" 직접 알 수 없음
2. **디버깅 어려움**: Theme 상태 추적이 CSS 환경에만 의존하여 런타임 디버깅 제한
3. **조건부 렌더링 제약**: Theme에 따른 다른 컴포넌트/로직 분기 처리 불가능
4. **유지보수성 저하**: Theme 관련 변경 시 CSS와 컴포넌트 로직 간 일관성 유지 어려움

## 관련 코드의 통합 구조 (Birdeye View)

```
PhoneSection (src/components/shared/PhoneSection/index.tsx)
├── PhoneFrame (src/components/shared/PhoneFrame/*)
├── MessageScreen (src/components/shared/MessageScreen/*)
├── CallScreen (src/components/shared/CallScreen/*)
├── HomeScreen (src/components/shared/HomeScreen/*)
├── SectionLabel (src/components/shared/SectionLabel/*)
└── IncomingCallOverlay (src/components/shared/CallScreen/IncomingCallOverlay/*)

Theme 시스템:
├── ThemeProvider (src/contexts/theme.tsx)
├── ThemeOverride (src/contexts/theme.tsx)
├── useTheme hook (src/hooks/useTheme.ts)
└── CSS 변수 시스템 (src/index.css)
```

## 변경 이후의 상태 / 해결 판정 기준

### 목표 상태
1. **명시적 Theme 분기**: 모든 하위 컴포넌트에서 `useTheme` hook을 통한 코드 레벨 Theme 분기
2. **Light Theme 강제 적용**: `ThemeOverride` 컴포넌트를 통한 구조적 Theme 제어
3. **코드 가독성 향상**: CSS-only 접근법에서 React Context 기반 접근법으로 전환

### 해결 판정 기준
- [ ] 모든 하위 컴포넌트에서 `useTheme` hook 사용
- [ ] PhoneSection이 `ThemeOverride`로 래핑되어 Light Theme 강제 적용
- [ ] CSS `.force-light-theme` 클래스 제거 및 코드 기반 Theme 제어로 전환
- [ ] Theme 변경 시 하위 컴포넌트들이 즉시 반응하는지 확인
- [ ] 빌드 및 TypeScript 타입 체크 통과

## 수정이 필요한 코드 및 수정부분의 코드 스니핏

### 1. PhoneSection 컴포넌트 수정
**파일**: `src/components/shared/PhoneSection/index.tsx`

```tsx
// 변경 전
import { PhoneFrame } from '@/components/shared/PhoneFrame';
// ... other imports

export function PhoneSection({...props}) {
  return (
    <motion.div className="relative landscape:w-[30vw] portrait:w-[40vw] aspect-[9/16]">
      <PhoneFrame>
        {/* ... */}
      </PhoneFrame>
    </motion.div>
  );
}

// 변경 후
import { PhoneFrame } from '@/components/shared/PhoneFrame';
import { ThemeOverride } from '@/contexts/theme';
// ... other imports

export function PhoneSection({...props}) {
  return (
    <ThemeOverride theme="light">
      <motion.div className="relative landscape:w-[30vw] portrait:w-[40vw] aspect-[9/16]">
        <PhoneFrame>
          {/* ... */}
        </PhoneFrame>
      </motion.div>
    </ThemeOverride>
  );
}
```

### 2. 하위 컴포넌트들에 useTheme 추가
**대상 파일들**:
- `src/components/shared/PhoneFrame/index.tsx`
- `src/components/shared/MessageScreen/index.tsx`
- `src/components/shared/CallScreen/index.tsx`
- `src/components/shared/HomeScreen/index.tsx`
- `src/components/shared/SectionLabel/index.tsx`
- `src/components/shared/CallScreen/IncomingCallOverlay/index.tsx`

**수정 패턴**:
```tsx
// 변경 전
export function ComponentName(props) {
  return (
    <div className="bg-white dark:bg-gray-900">
      {/* content */}
    </div>
  );
}

// 변경 후
import { useTheme } from '@/hooks/useTheme';

export function ComponentName(props) {
  const { isDark, isLight } = useTheme();
  
  return (
    <div className={isDark ? 'bg-gray-900' : 'bg-white'}>
      {/* content */}
    </div>
  );
}
```

### 3. CSS 정리
**파일**: `src/index.css`

```css
/* 제거할 코드 */
.force-light-theme,
.force-light-theme * {
  color-scheme: light !important;
}

.force-light-theme:not(.dark),
.force-light-theme:not(.dark) * {
  /* ... CSS 변수들 */
}
```

## 재사용 가능한 연관 코드

### Theme 시스템 컴포넌트
- **ThemeOverride**: `src/contexts/theme.tsx`
  - 기능: 특정 하위 트리에 Theme 강제 적용
  - 인터페이스: `{ children: ReactNode; theme: Theme }`
  
- **useTheme hook**: `src/hooks/useTheme.ts`
  - 기능: Theme 상태 및 제어 함수 제공
  - 반환값: `{ isDark, isLight, theme, resolvedTheme, setTheme, ... }`

### 유틸리티 함수
- **cn 함수**: `src/lib/utils.ts`
  - 기능: className 조건부 병합
  - 사용법: `cn(baseClass, condition && conditionalClass)`

## Test Code 추가 및 수정 필요 부분에 대한 가이드

### 1. Theme 전환 테스트
```tsx
// tests/PhoneSection.test.tsx
describe('PhoneSection Theme Override', () => {
  it('should always render in light theme regardless of parent theme', () => {
    // Dark theme provider로 래핑 후 PhoneSection이 Light theme으로 렌더링되는지 확인
  });
  
  it('should propagate light theme to all child components', () => {
    // 하위 컴포넌트들이 모두 Light theme 스타일로 렌더링되는지 확인
  });
});
```

### 2. useTheme 통합 테스트
```tsx
// tests/components/shared/*.test.tsx
describe('Component Theme Integration', () => {
  it('should respond to theme changes via useTheme hook', () => {
    // Theme context 변경 시 컴포넌트가 적절히 리렌더링되는지 확인
  });
});
```

### 3. 성능 테스트
- Theme 변경 시 불필요한 리렌더링 발생 여부 확인
- `ThemeOverride` 래핑으로 인한 성능 영향 측정

## 추가 분석 과제

### 1. 기존 CSS 의존성 분석
- 각 하위 컴포넌트에서 `dark:` prefix 사용 현황 조사
- CSS 변수 직접 참조 코드 식별

### 2. Theme 전환 애니메이션 고려사항
- Theme 변경 시 부드러운 전환 효과 필요성 검토
- CSS transition vs. Framer Motion 기반 애니메이션 선택

### 3. 접근성(Accessibility) 영향 분석
- `prefers-color-scheme` 미디어 쿼리와의 상호작용
- 강제 Light Theme이 사용자 선호도에 미치는 영향

### 4. 번들 크기 영향 평가
- `useTheme` hook 추가로 인한 번들 크기 변화
- Tree-shaking 최적화 가능성

---

**작성일**: 2025년 9월 23일  
**작성자**: AI Assistant  
**예상 작업 시간**: 4-6시간  
**우선순위**: 중간 (기능 개선, 유지보수성 향상)